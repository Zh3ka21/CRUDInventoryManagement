{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-12">
        <h2>Search Product</h2>
        <form method="GET" action="{{ url_for('products.manage_products') }}">
            <div class="form-row">
                <div class="form-group col-md-8">
                    <label for="search_name">Product Name:</label>
                    <input type="text" class="form-control" id="search_name" name="search_name" required>
                </div>
                <div class="form-group col-md-4 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">Search</button>
                </div>
            </div>
        </form>
        <hr>
        {% if products %}
        <h2>Update or Delete Product</h2>
        {% for product in products %}
        <div class="card mb-3">
            <div class="card-body">
                <form method="POST" action="{{ url_for('products.manage_products') }}">
                    <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="update_name" value="{{ product.name }}">
                    <div class="form-row">
                        <div class="form-group col-md-2">
                            <label for="update_name">Name:</label>
                            <input type="text" class="form-control" id="update_name" name="update_name"
                                value="{{ product.name }}" readonly>
                        </div>
                        <div class="form-group col-md-2">
                            <label for="update_count">Count:</label>
                            <input type="number" class="form-control" id="update_count" name="update_count"
                                value="{{ product.count }}" required>
                        </div>
                        <div class="form-group col-md-4">
                            <label for="update_description">Description:</label>
                            <textarea class="form-control" id="update_description"
                                name="update_description">{{ product.description }}</textarea>
                        </div>
                        <div class="form-group col-md-2">
                            <label for="update_category">Category:</label>
                            <input type="text" class="form-control" id="update_category" name="update_category"
                                value="{{ product.category }}" required>
                        </div>
                        <div class="form-group col-md-2">
                            <label for="update_price_per_unit">Price per Unit ($):</label>
                            <input type="number" step="0.01" class="form-control" id="update_price_per_unit"
                                name="update_price_per_unit" value="{{ product.price_per_unit }}" required>
                        </div>
                        <div class="form-group col-md-2">
                            <label for="update_supplier">Supplier:</label>
                            <input type="text" class="form-control" id="update_supplier" name="update_supplier"
                                value="{{ product.supplier }}" required>
                        </div>
                        <div class="form-group col-md-2 d-flex align-items-end">
                            <button type="submit" name="update_product" class="btn btn-primary w-100">Update</button>
                        </div>
                        <div class="form-group col-md-2 d-flex align-items-end">
                            <button type="submit" name="delete_product" class="btn btn-danger w-100">Delete</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        {% endfor %}
        {% endif %}
        <hr>
        <h2>Add New Product</h2>
        <form method="POST" action="{{ url_for('products.manage_products') }}">
            <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
            <div class="form-row">
                <div class="form-group col-md-2">
                    <label for="name">Name:</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>
                <div class="form-group col-md-2">
                    <label for="count">Count:</label>
                    <input type="number" class="form-control" id="count" name="count" required>
                </div>
                <div class="form-group col-md-4">
                    <label for="description">Description:</label>
                    <textarea class="form-control" id="description" name="description"></textarea>
                </div>
                <div class="form-group col-md-2">
                    <label for="category">Category:</label>
                    <input type="text" class="form-control" id="category" name="category" required>
                </div>
                <div class="form-group col-md-2">
                    <label for="price_per_unit">Price per Unit ($):</label>
                    <input type="number" step="0.01" class="form-control" id="price_per_unit" name="price_per_unit"
                        required>
                </div>
                <div class="form-group col-md-2">
                    <label for="supplier">Supplier:</label>
                    <input type="text" class="form-control" id="supplier" name="supplier" required>
                </div>
                <div class="form-group col-md-2 d-flex align-items-end">
                    <button type="submit" name="add_product" class="btn btn-primary w-100">Add Product</button>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Select all input elements with type number
        var numberInputs = document.querySelectorAll('input[type="number"]');

        // Attach event listener to form submission
        document.querySelector('form').addEventListener('submit', function (event) {
            var valid = true;

            // Check each number input
            numberInputs.forEach(function (input) {
                if (input.hasAttribute('required') && input.value < 0) {
                    alert('Count cannot be less than zero!');
                    event.preventDefault(); // Prevent form submission
                    valid = false;
                }
            });

            return valid;
        });
    });
</script>
{% endblock %}